<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Checkout | E-Commerce Store</title>

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background-color: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto;
        }

        .header-section {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 1.5rem 0;
            border-radius: 0 0 10px 10px;
            margin-bottom: 1rem;
        }

        .checkout-container {
            max-width: 1200px;
            margin: auto;
            padding: 0 15px;
        }

        .checkout-card {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            border-bottom: 2px solid #f0f2f5;
            padding-bottom: .5rem;
            margin-bottom: 1rem;
        }

        .payment-method-card {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: .75rem;
            margin-bottom: .5rem;
            cursor: pointer;
        }

        .payment-method-card.active {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .payment-method-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .order-summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: .75rem 0;
            border-bottom: 1px solid #f0f2f5;
        }

        .total-amount {
            font-weight: 700;
            font-size: 1.2rem;
        }

        .proceed-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: .9rem;
            font-weight: 600;
        }

        .product-img {
            width: 55px;
            height: 55px;
            object-fit: cover;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .loading-spinner {
            display: none;
            text-align: center;
            margin: 1rem 0;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .success-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,.5);
            display: flex;
            align-items: center;
            justify-content: center;
            visibility: hidden;
        }

        .success-modal.show {
            visibility: visible;
        }

        .success-modal-content {
            background: #fff;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
        }
    </style>
</head>

<body>

<div class="header-section text-center text-white">
    <h1>Secure Checkout</h1>
    <p>Complete your purchase securely</p>
</div>

<div class="checkout-container">

    <div class="row g-4">

        <!-- LEFT -->
        <div class="col-lg-7">
            <div class="checkout-card">
                <h2 class="section-title">Customer Information</h2>

                <form id="checkoutForm">
                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <label>Full Name *</label>
                            <input class="form-control" id="name" required>
                        </div>
                        <div class="col-md-6 mb-2">
                            <label>Email *</label>
                            <input type="email" class="form-control" id="email" required>
                        </div>
                        <div class="col-md-6 mb-2">
                            <label>Phone *</label>
                            <input class="form-control" id="phone" required>
                        </div>
                        <div class="col-md-6 mb-2">
                            <label>Pincode *</label>
                            <input class="form-control" id="pincode" required>
                        </div>
                    </div>

                    <label>Address *</label>
                    <textarea class="form-control mb-2" id="address" rows="2" required></textarea>

                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <label>City *</label>
                            <input class="form-control" id="city" required>
                        </div>
                        <div class="col-md-6 mb-2">
                            <label>State *</label>
                            <input class="form-control" id="state" required>
                        </div>
                    </div>
                </form>
            </div>

            <div class="checkout-card">
                <h2 class="section-title">Payment Method</h2>

                <div class="payment-method-card active">
                    <div class="d-flex align-items-center">
                        <div class="payment-method-icon me-3">ðŸ’³</div>
                        <div>
                            <input type="radio" checked> Razorpay (Card / UPI)
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT -->
        <div class="col-lg-5">
            <div class="checkout-card">
                <h2 class="section-title">Order Summary</h2>

                <div class="order-summary-item">
                    <div class="d-flex align-items-center">
                        <img src="/images/product1.jpg" class="product-img me-3">
                        <div>
                            <strong>Sample Product 1</strong><br>
                            <small>Qty: 1</small>
                        </div>
                    </div>
                    <span>â‚¹999</span>
                </div>

                <div class="order-summary-item">
                    <div class="d-flex align-items-center">
                        <img src="/images/product2.jpg" class="product-img me-3">
                        <div>
                            <strong>Sample Product 2</strong><br>
                            <small>Qty: 2</small>
                        </div>
                    </div>
                    <span>â‚¹1,998</span>
                </div>

                <div class="order-summary-item total-amount">
                    <span>Total</span>
                    <span id="totalAmount">â‚¹2997</span>
                </div>

                <div class="loading-spinner" id="loading">
                    <div class="spinner"></div>
                    Processing...
                </div>

                <button class="proceed-btn mt-3" onclick="processPayment()">Proceed to Payment</button>
            </div>
        </div>

    </div>
</div>

<!-- SUCCESS MODAL -->
<div class="success-modal" id="successModal">
    <div class="success-modal-content">
        <h3>Payment Successful</h3>
        <p>Redirecting to orders...</p>
    </div>
</div>

<script>
    async function processPayment() {
        const amount = 2997;

        const response = await fetch('/createOrder', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                email: document.getElementById('email').value,
                amount: amount
            })
        });

        const order = await response.json();

        const options = {
            key: "rzp_test_RtVxX2GgS4LcYd",
            amount: amount * 100,
            currency: "INR",
            order_id: order.razorpayOrderId,
            handler: async function (response) {
                await fetch('/paymentCallback', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                    body: new URLSearchParams(response)
                });
                document.getElementById('successModal').classList.add('show');
                setTimeout(() => window.location.href = '/orders', 3000);
            }
        };

        new Razorpay(options).open();
    }
</script>

</body>
</html>
